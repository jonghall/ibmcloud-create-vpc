-
  vpc: ecommerce-vpc
  region: us-south
  classic_access: false
  resource_group: default
  default_network_acl: ecommerce-vpc-default-acl
  generation: 1
  address_prefix:
    -
      name: ecommerce-vpc-zone-1
      zone: us-south-1
      cidr: 172.16.0.0/18
    -
      name: ecommerce-vpc-zone-2
      zone: us-south-2
      cidr: 172.16.64.0/18
    -
      name: ecommerce-vpc-zone-3
      zone: us-south-3
      cidr: 172.16.128.0/18
  zones:
    -
      name: us-south-1
      subnets:
        -
          name: web-tier-us-south-1
          ipv4_cidr_block: 172.16.0.0/24
          network_acl: ecommerce-vpc-default-acl
          publicGateway: true
          instances:
            -
              name: web%02d-us-south-1
              quantity: 1
              template: web_server
              floating_ip: true
              security_group: ecommerce-vpc-webtier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-webtier-lb01
                  lb_pool: nginx-http
                  listen_port: 80
        -
          name: app-tier-us-south-1
          ipv4_cidr_block: 172.16.16.0/24
          network_acl: ecommerce-vpc-default-acl
          publicGateway: true
          instances:
            -
              name: app%02d-us-south-1
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-apptier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: index_php_upstream
                  listen_port: 8090
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: direct_php_upstream
                  listen_port: 8091
        -
          name: db-tier-us-south-1
          ipv4_cidr_block: 172.16.32.0/24
          network_acl: ecommerce-vpc-default-acl
          publicGateway: true
          instances:
            -
              name: db%02d-us-south-1
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-dbtier
    -
      name: us-south-2
      subnets:
        -
          name: web-tier-us-south-2
          ipv4_cidr_block: 172.16.64.0/24
          publicGateway: true
          network_acl: ecommerce-vpc-default-acl
          instances:
            -
              name: web%02d-us-south-2
              quantity: 1
              template: web_server
              floating_ip: true
              security_group: ecommerce-vpc-webtier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-webtier-lb01
                  lb_pool: nginx-http
                  listen_port: 80
        -
          name: app-tier-us-south-2
          ipv4_cidr_block: 172.16.80.0/24
          network_acl: ecommerce-vpc-default-acl
          publicGateway: true
          instances:
            -
              name: app%02d-us-south-2
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-apptier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: index_php_upstream
                  listen_port: 8090
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: direct_php_upstream
                  listen_port: 8091
        -
          name: db-tier-us-south-2
          ipv4_cidr_block: 172.16.96.0/24
          network_acl: ecommerce-vpc-default-acl
          publicGateway: true
          instances:
            -
              name: db%02d-us-south-2
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-dbtier
    -
      name: us-south-3
      subnets:
        -
          name: web-tier-us-south-3
          ipv4_cidr_block: 172.16.128.0/24
          network_acl: ecommerce-vpc-default-acl
          publicGateway: true
          instances:
            -
              name: web%02d-us-south-3
              quantity: 1
              template: web_server
              floating_ip: true
              security_group: ecommerce-vpc-webtier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-webtier-lb01
                  lb_pool: nginx-http
                  listen_port: 80
        -
          name: app-tier-us-south-3
          ipv4_cidr_block: 172.16.144.0/24
          network_acl: ecommerce-vpc-default-acl
          publicGateway: true
          instances:
            -
              name: app%02d-us-south-3
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-apptier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: index_php_upstream
                  listen_port: 8090
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: direct_php_upstream
                  listen_port: 8091
        -
          name: db-tier-us-south-3
          ipv4_cidr_block: 172.16.160.0/24
          network_acl: ecommerce-vpc-default-acl
          publicGateway: true
          instances:
             -
              name: db%02d-us-south-3
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-dbtier
  load_balancers:
    -
      lbInstance: ecommerce-vpc-webtier-lb01
      is_public: true
      subnets:
        - web-tier-us-south-1
        - web-tier-us-south-2
      listeners:
        -
          protocol: http
          port: 80
          connection_limit: 100
          default_pool_name: nginx-http
      pools:
        -
          name: nginx-http
          protocol: http
          algorithm: round_robin
          health_monitor:
            type: http
            delay: 5
            max_retries: 2
            timeout: 2
            url_path: /nginx_status
    -
      lbInstance: ecommerce-vpc-apptier-lb01
      is_public: false
      subnets:
        - app-tier-us-south-1
        - app-tier-us-south-2
      listeners:
        -
          protocol: http
          port: 8090
          connection_limit: 100
          default_pool_name: index_php_upstream
        -
          protocol: http
          port: 8091
          connection_limit: 100
          default_pool_name: direct_php_upstream
      pools:
        - name: index_php_upstream
          protocol: http
          algorithm: least_connections
          health_monitor:
            type: http
            delay: 5
            max_retries: 2
            timeout: 2
            url_path: /
        - name: direct_php_upstream
          protocol: http
          algorithm: least_connections
          health_monitor:
            type: http
            delay: 5
            max_retries: 2
            timeout: 2
            url_path: /
  instanceTemplates:
    -
      template: web_server
      image: ubuntu-16.04-amd64
      profile_name: c-2x4
      sshkey: my-ssh-key
      cloud-init-file: cloud-init.txt
    -
      template: app_server
      image: ubuntu-16.04-amd64
      profile_name: c-4x8
      sshkey: my-ssh-key
      cloud-init-file: cloud-init.txt
    -
      template: db_server
      image: ubuntu-16.04-amd64
      profile_name: m-8x32
      sshkey: my-ssh-key
      cloud-init-file: cloud-init.txt
  security_groups:
    -
      security_group: ecommerce-vpc-webtier
      rules:
         -
          direction: inbound
          ip_version: ipv4
          protocol: all
          remote:
            cidr_block: 172.16.0.0/24
         -
          direction: inbound
          ip_version: ipv4
          protocol: all
          remote:
            cidr_block: 172.16.64.0/24
         -
          direction: inbound
          ip_version: ipv4
          protocol: all
          remote:
            cidr_block: 172.16.128.0/24
         -
          direction: outbound
          ip_version: ipv4
          protocol: all
          remote:
            cidr_block: 0.0.0.0/0
    -
      security_group: ecommerce-vpc-apptier2
      rules:
        -
          direction: inbound
          ip_version: ipv4
          protocol: all
          remote:
            cidr_block: 172.16.16.0/24
        -
          direction: inbound
          ip_version: ipv4
          protocol: all
          remote:
            cidr_block: 172.16.80.0/24
        -
          direction: inbound
          ip_version: ipv4
          protocol: all
          remote:
            cidr_block: 172.16.144.0/24
        -
          direction: inbound
          ip_version: ipv4
          port_min: 8090
          port_max: 8091
          protocol: tcp
          remote:
            security_group: ecommerce-vpc-webtier
        -
          direction: outbound
          ip_version: ipv4
          protocol: all
          remote:
            cidr_block: 0.0.0.0/0
  network_acls:
    - network_acl: ecommerce-vpc-default-acl
      rules:
        - name: allow-all-in
          direction: inbound
          action: allow
          source: 0.0.0.0/0
          destination: 0.0.0.0/0
        - name: allow-all-out
          direction: outbound
          action: allow
          source: 0.0.0.0/0
          destination: 0.0.0.0/0
  sshkeys:
    - sshkey: my-ssh-key
      public_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDQ6H4W/5PCtVb6BEgbxNdgDbrJsAFD/Y13mz+qVhM6kHmoOBu5tbbQh7LGfCjpHzZ2A59m2i3zpFNwA9r06UErIfG8U020QAnirrmpo1qqB9tMI7BRSyvf5NFXnUklyszQSsXxxM6eYiQLiHDNnVN7Qyzgq5YcZ8eb559KzmyretdPulEBQvWKZyUbE03kX8ScNTI87p/jX/464viudryjtLgUNuJoFtCCYdoolvnNZsAq3wBl9LOgNaT33nP1ys1R4azG3pC921WX5+g4txws7tVzjPB/e5caOYdGXbFnYi2TXY3agX0wCNj/p/nPEO29c7s7kzEZN9o8ygSrj+Yn

